=== PLSパラメータ詳細画面

==== 概要

[.lead]
PLSのパラメータ設定用に各種リソースの登録、更新、削除を行う。

===== 画面イメージ

====== 新規作成時の初期表示
[plantuml]
--
salt
{
  {
    BG名 | パワオプ東京BG
  }
  {
    種別 | ()BG | ()JEPXスポット | ()JEPX1時間前 | ()常時バックアップ | ()FIT | ()相対
  }
}
--

====== BG選択時
[plantuml]
--
salt
{
  {
    [保存]
  }
  {
    BG名 | パワオプ東京BG
  }
  {
    種別 | (X)BG | ()JEPXスポット | ()JEPX1時間前 | ()常時バックアップ | ()FIT | ()相対
  }
  {
    会社名 | ^パワーオプティマイザー^
    コード | "BG111"
  }
}
--

====== JEPXスポット選択時
[plantuml]
--
salt
{
  {
    [保存]
  }
  {
    BG名 | パワオプ東京BG
  }
  {
    種別 | ()BG | (X)JEPXスポット | ()JEPX1時間前 | ()常時バックアップ | ()FIT | ()相対
  }
  {
    会社名 | ^パワーオプティマイザー^
    コード | "JEPX  "
    最大量 | " 10000"
    最小量 | "     0"
    単位量 | "    50"
  }
}
--

====== JEPX1時間前選択時
[plantuml]
--
salt
{
  {
    [保存]
  }
  {
    BG名 | パワオプ東京BG
  }
  {
    種別 | ()BG | ()JEPXスポット | (X)JEPX1時間前 | ()常時バックアップ | ()FIT | ()相対
  }
  {
    会社名 | ^パワーオプティマイザー^
    コード | "JEPX "
    最大量 | " 10000"
    最小量 | "     0"
    単位量 | "    50"
  }
}
--

====== 常時バックアップ選択時
[plantuml]
--
salt
{
  {
    [保存]
  }
  {
    BG名 | パワオプ東京BG
  }
  {
    種別 | ()BG | ()JEPXスポット | ()JEPX1時間前 | (X)常時バックアップ | ()FIT | ()相対
  }
  {
    会社名 | ^パワーオプティマイザー^
    コード | "ERSD1"
  }
  {
    [行追加]
  }
  {#
    開始日       | 契約容量 | 基本料金 | 従量料金(夏季昼間) | 従量料金(他期昼間) | 従量料金(夜間)| 従量料金(ピークタイム) | 燃料調整費単価
    ^2014/01/01^ | " 500"    | "1200"   | "  20"  | "  10" | "   5" | "  20" | " 1.3"
    ^2014/02/01^ | " 500"    | "1210"   | "  21"  | "  11" | "   5" | "  21" | " 1.3"
    ^2016/04/03^ | " 500"    | "1230"   | "  22"  | "  10" | "   4" | "  21" | " 2.3"
  }
}
--

====== FIT選択時
[plantuml]
--
salt
{
  {
    [保存]
  }
  {
    BG名 | パワオプ東京BG
  }
  {
    種別 | ()BG | ()JEPXスポット | ()JEPX1時間前 | ()常時バックアップ | (X)FIT | ()相対
  }
  {
    会社名   | ^パワーオプティマイザー^
    コード   | "ERSD1"
  }
  {
    [発電BG追加]
  }
  {
    {
      [発電所BG削除] | *
      コード   | "ERSD1"
      発電BG名 | "           "
      契約No.  | "           "
      [発電所追加] | *
    }
    {#
      .      | コード    | 名前 | 契約No. | 最大量
      [削除] | "XXXXX" | "鬼怒川PV" | "YYYYY00 " | "1000"
      [削除] | "XXXXZ" | "熱海PV  " | "YYYYY01 " | " 500"
    }
  }
  {
    {
      [発電所BG削除] | *
      コード   | "ERSD2"
      発電BG名 | "           "
      契約No.  | "           "
      [発電所追加] | *
    }
    {#
      .      | コード    | 名前 | 契約No. | 最大量
      [削除] | "XXXXX" | "草津PV" | "YYYYY00 " | "1000"
      [削除] | "XXXXZ" | "下呂PV  " | "YYYYY01 " | " 500"
    }
  }
}
--

====== 相対選択時
[plantuml]
--
salt
{
  {
    [保存]
  }
  {
    BG名 | パワオプ東京BG
  }
  {
    種別 | ()BG | ()JEPXスポット | ()JEPX1時間前 | ()常時バックアップ | ()FIT | (X)相対
  }
  {
    会社名   | ^パワーオプティマイザー^
    コード   | "ERSD1"
    名前     | "           "
    契約No.  | "           "
  }
  {
    [行追加]
  }
  {#
    . | . | . | 年 | 月 | 日 | 曜日 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 30 | 31 | 32 | 33 | 34 | 35 | 36 | 37 | 38 | 39 | 40 | 41 | 42 | 43 | 44 | 45 | 46 | 47 | 48
    [削除] | [↑] | [↓] | 2020 | 1  | 1 | \*   | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10"
    [削除] | [↑] | [↓] | 2020 | 2  | \*  | \*   | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10"
    [削除] | [↑] | [↓] | \*  | 3  | \*  |  1   | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10"
    [削除] | [↑] | [↓] | \*  | \*  | \*  |  \*   | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10" | "10"
  }
}
--

===== I/O関連図

[plantuml]
--
rectangle {
  database "バランシンググループ" as input_1
  database "BGメンバー" as input_2
  database "バランシン会社ググループ" as input_3

  (PLSパラメータ詳細画面) as prog

  database "リソース" as io_1
  database "常時バックアップ電源契約" as io_2
  database "発電者" as io_3
  database "相対取引設定" as io_4
}

input_1 --> prog : input
input_2 --> prog : input
input_3 --> prog : input
prog <--> io_1 : input / output
prog <--> io_2 : input / output
prog <--> io_3 : input / output
prog <--> io_4 : input / output
--

===== I/O

|======================================
| 名称                           | 物理名                     | 種類 | I/O種別    | 備考
| バランシンググループ           | balancing_groups           | DB   | I          |
| BGメンバー                     | bg_members                 | DB   | I          |
| 会社                           | companies                  | DB   | I          |
| リソース                       | resources                  | DB   | I/O        |
| 常時バックアップ電源契約       | jbu_contracts              | DB   | I/O        |
| 発電BG                         | power_generator_groups     | DB   | I/O        |
| 発電者                         | power_generators           | DB   | I/O        |
| 相対取引設定                   | matching_trade_settings    | DB   | I/O        |
|======================================

==== 使用するAPI

|======================================
| 処理名                         | エンドポイント
| リソース取得API                | GET /v1/resources/:resource_id
| リソース作成API                | POST /v1/resources
| リソース更新API                | PATCH /v1/resources/:resource_id
|======================================



<<<

==== 画面項目定義

===== 新規作成時の初期表示

|======================================
| 項目名 | 項目種別 | 物理項目名 | 取得元               | I/O | 備考
| 保存   | ボタン   |            |                      |     | type未選択の場合は無効にする
| BG名   | ラベル   | name       | バランシンググループ | O   |
| 種別   | ラジオ   | type       | リソース             | I/O |
|======================================

===== BG選択時

|======================================
| 項目名 | 項目種別 | 物理項目名 | 取得元               | I/O | 備考
| 保存   | ボタン           |              |                      |     |
| BG名   | ラベル           | name         | バランシンググループ | O   |
| 種別   | ラジオ           | type         | リソース             | I/O |
| 会社名 | ドロップダウン   | bg_member_id | リソース             | I/O | ドロップダウンリストはBG IDに対応するBGメンバーについてidをbg_member.id、名称をbg_member.company.nameから取得して生成。なお、値はバランシンググループのleader_company_id固定
| コード | テキスト         | code         | リソース             | I/O | 5桁の英数字
|======================================

===== JEPXスポット選択時

|======================================
| 項目名 | 項目種別 | 物理項目名 | 取得元               | I/O | 備考
| 保存   | ボタン   |            |                      |     |
| BG名   | ラベル   | name       | バランシンググループ | O   |
| 種別   | ラジオ   | type       | リソース             | I/O |
| 会社名 | ドロップダウン   | bg_member_id | リソース             | I/O | ドロップダウンリストはBG IDに対応するBGメンバーについてidをbg_member.id、名称をbg_member.company.nameから取得して生成。なお、値はバランシンググループのleader_company_id固定
| コード | テキスト         | code         | リソース             | I/O | 5桁の英数字
| 最大値 | テキスト         | max_value    | リソース             | I/O | 整数値
| 最小値 | テキスト         | min_value    | リソース             | I/O | 整数値(最大値より小さいこと)
| 単位量 | テキスト         | unit         | リソース             | I/O | 自然数(最大値・最小値を剰余なしで除算可能なこと)

|======================================

===== JEPX1時間前選択時

|======================================
| 項目名 | 項目種別 | 物理項目名 | 取得元               | I/O | 備考
| 保存   | ボタン   |            |                      |     |
| BG名   | ラベル   | name       | バランシンググループ | O   |
| 種別   | ラジオ   | type       | リソース             | I/O |
| 会社名 | ドロップダウン   | bg_member_id | リソース             | I/O | ドロップダウンリストはBG IDに対応するBGメンバーについてidをbg_member.id、名称をbg_member.company.nameから取得して生成。なお、値はバランシンググループのleader_company_id固定
| コード | テキスト         | code         | リソース             | I/O | 5桁の英数字
| 最大値 | テキスト         | max_value    | リソース             | I/O | 整数値
| 最小値 | テキスト         | min_value    | リソース             | I/O | 整数値(最大値より小さいこと)
| 単位量 | テキスト         | unit         | リソース             | I/O | 自然数(最大値・最小値を剰余なしで除算可能なこと)
|======================================

===== 常時バックアップ選択時

|======================================
| 項目名 | 項目種別 | 物理項目名 | 取得元               | I/O | 備考
| 保存   | ボタン   |            |                      |     |
| BG名   | ラベル   | name       | バランシンググループ | O   |
| 種別   | ラジオ   | type       | リソース             | I/O |
| 会社名 | ドロップダウン   | bg_member_id | リソース             | I/O | ドロップダウンリストはBG IDに対応するBGメンバーについてidをbg_member.id、名称をbg_member.company.nameから取得して生成。
| コード | テキスト | code       | リソース             | I/O | 5桁の英数字
| 行追加 | ボタン   |            |                      |     |
| 開始日   | 日付     | start_date     | 常時バックアップ電源契約 | I/O |
| 契約容量 | テキスト | contract_power | 常時バックアップ電源契約 | I/O | 整数
| 基本料金 | テキスト | basic_charge   | 常時バックアップ電源契約 | I/O | 数値(小数あり)
| 従量料金(夏季昼間)     | テキスト | meter_rate_charge_summer_season_daytime | 常時バックアップ電源契約 | I/O | 数値(小数あり)
| 従量料金(他季昼間)     | テキスト | meter_rate_charge_other_season_daytime  | 常時バックアップ電源契約 | I/O | 数値(小数あり)
| 従量料金(夜間)         | テキスト | meter_rate_charge_night                 | 常時バックアップ電源契約 | I/O | 数値(小数あり)
| 従量料金(ピークタイム) | テキスト | meter_rate_charge_peak_time             | 常時バックアップ電源契約 | I/O | 数値(小数あり)
| 燃料費調整単価         | テキスト | fuel_cost_adjustment_charge             | 常時バックアップ電源契約 | I/O | 数値(小数あり)
|======================================

===== FIT選択時

|======================================
| 項目名 | 項目種別 | 物理項目名 | 取得元               | I/O | 備考
| 保存   | ボタン   |            |                      |     |
| BG名   | ラベル   | name       | バランシンググループ | O   |
| 種別   | ラジオ   | type       | リソース             | I/O |
| 会社名 | ドロップダウン   | bg_member_id | リソース             | I/O | ドロップダウンリストはBG IDに対応するBGメンバーについてidをbg_member.id、名称をbg_member.company.nameから取得して生成。
| コード   | テキスト | code            | リソース             | I/O | 5桁の英数字
| 行追加   | ボタン   |                 |                      |     |
| 削除     | ボタン   |                 |                      |     |
| コード   | テキスト | code            | 発電BG               | I/O | 5桁の英数字
| 名前     | テキスト | name            | 発電BG               | I/O |
| 契約No.  | テキスト | contract_number | 発電BG               | I/O |
| コード   | テキスト | code            | 発電者               | I/O | 5桁の英数字
| 名前     | テキスト | name            | 発電者               | I/O |
| 契約No.  | テキスト | contract_number | 発電者               | I/O |
| 最大量   | テキスト | supply_max      | 発電者               | I/O | 整数
|======================================

===== 相対選択時

|======================================
| 項目名   | 項目種別 | 物理項目名            | 取得元               | I/O | 備考
| 保存     | ボタン   |                       |                      |     |
| BG名     | ラベル   | name                  | バランシンググループ | O   |
| 種別     | ラジオ   | type                  | リソース             | I/O |
| コード   | テキスト | code                  | リソース             | I/O | 5桁の英数字
| 名前     | テキスト | name                  | リソース             | I/O |
| 契約No.  | テキスト | contract_number       | リソース             | I/O |
| 行追加   | ボタン   |                       |                      |     |
| 削除     | ボタン   |                       |                      |     |
| 上へ     | ボタン   |                       |                      |     |
| 下へ     | ボタン   |                       |                      |     |
| 年       | テキスト | year                  | 相対取引設定         | I/O | *または4桁の数字
| 月       | テキスト | month                 | 相対取引設定         | I/O | *又は1～12までの数字又は、対象月をハイフン及びカンマ区切りで構成した文字列
| 日       | テキスト | day                   | 相対取引設定         | I/O | *又は1～31までの数字又は、対象日をハイフン及びカンマ区切りで構成した文字列
| 曜日     | テキスト | day_of_week           | 相対取引設定         | I/O | *又は0～6までの曜日番号又は、対象曜日番号をハイフン及びカンマ区切りで構成した文字列
| 1～48    | テキスト | time_index_(コマ番号) | 相対取引設定         | I/O | 整数値
|======================================

<<<

==== 機能詳細

===== 初期表示

. 新規の場合、BG IDをパラメータとして取り、画面項目定義に従って表示を行う。
. 更新の場合、リソースIDをパラメータとして取り、リソースをAPIで取得する。このときリソースの種別に応じて、それぞれに対応する詳細画面を表示する。

===== 種別変更時

. リソースの種別が変更された場合は、その種別に応じて、それぞれに対応する詳細画面を表示する。
. リソースの種別が未選択から選択された状態に変化した場合、保存ボタンを有効にする。(未選択時は無効にする)

===== 保存ボタン押下時

. 入力された内容に基づき、リソース及び関連データをAPIを使用して保存する。
.. 保存時にエラーがあり、保存できなかった場合はエラーの内容を画面に表示する。

<<<

